{
  "recordID": "GenerateContentStreamErrorHandlingTest.GenerateContentStreamEnterpriseWebSearchVertexTest",
  "interactions": [
    {
      "request": {
        "method": "POST",
        "url": "/v1beta1/projects/REDACTED/locations/us-central1/publishers/google/models/gemini-2.0-flash:streamGenerateContent?alt=sse",
        "request": "POST /v1beta1/projects/REDACTED/locations/us-central1/publishers/google/models/gemini-2.0-flash:streamGenerateContent?alt=sse HTTP/1.1",
        "headers": {
          "Content-Length": "162",
          "Content-Type": "application/json; charset=utf-8",
          "Test-Name": "GenerateContentStreamErrorHandlingTest.GenerateContentStreamEnterpriseWebSearchVertexTest"
        },
        "bodySegments": [
          {
            "contents": [
              {
                "parts": [
                  {
                    "text": "Why is the sky blue?"
                  }
                ],
                "role": "user"
              }
            ],
            "generationConfig": {},
            "tools": [
              {
                "enterpriseWebSearch": {
                  "excludeDomains": [
                    "amazon.com"
                  ]
                }
              }
            ]
          }
        ],
        "previousRequest": "b4d6e60a9b97e7b98c63df9308728c5c88c0b40c398046772c63447b94608b4d",
        "serverAddress": "us-central1-aiplatform.googleapis.com",
        "port": 443,
        "protocol": "https"
      },
      "shaSum": "2c1ff325db56e1c1e6012e19660eaa12cf076cabcd513754869e08c66cbba066",
      "response": {
        "statusCode": 200,
        "headers": {
          "Content-Disposition": "attachment",
          "Content-Type": "text/event-stream",
          "Date": "Thu, 28 Aug 2025 03:55:46 GMT",
          "Server": "scaffolding on HTTPServer2",
          "Vary": "Origin, X-Origin, Referer",
          "X-Content-Type-Options": "nosniff",
          "X-Frame-Options": "SAMEORIGIN",
          "X-Xss-Protection": "0"
        },
        "bodySegments": [
          {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "The sky appears blue"
                    }
                  ],
                  "role": "model"
                },
                "groundingMetadata": {}
              }
            ],
            "createTime": "2025-08-28T03:55:44.786936Z",
            "modelVersion": "gemini-2.0-flash",
            "responseId": "QNOvaPiDMI_3ld8Py4ySuAk",
            "usageMetadata": {
              "billablePromptUsage": {
                "textCount": 16
              },
              "trafficType": "PROVISIONED_THROUGHPUT"
            }
          },
          {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": " due to a phenomenon called Rayleigh scattering. Here's a"
                    }
                  ],
                  "role": "model"
                },
                "groundingMetadata": {}
              }
            ],
            "createTime": "2025-08-28T03:55:44.786936Z",
            "modelVersion": "gemini-2.0-flash",
            "responseId": "QNOvaPiDMI_3ld8Py4ySuAk",
            "usageMetadata": {
              "trafficType": "PROVISIONED_THROUGHPUT"
            }
          },
          {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": " breakdown:\n\n*   **Sunlight and its colors:** Sunlight is composed of all the colors"
                    }
                  ],
                  "role": "model"
                },
                "groundingMetadata": {}
              }
            ],
            "createTime": "2025-08-28T03:55:44.786936Z",
            "modelVersion": "gemini-2.0-flash",
            "responseId": "QNOvaPiDMI_3ld8Py4ySuAk",
            "usageMetadata": {
              "trafficType": "PROVISIONED_THROUGHPUT"
            }
          },
          {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": " of the rainbow.\n*   **Atmospheric scattering:** When sunlight enters the Earth's atmosphere, it interacts with air molecules ("
                    }
                  ],
                  "role": "model"
                },
                "groundingMetadata": {}
              }
            ],
            "createTime": "2025-08-28T03:55:44.786936Z",
            "modelVersion": "gemini-2.0-flash",
            "responseId": "QNOvaPiDMI_3ld8Py4ySuAk",
            "usageMetadata": {
              "trafficType": "PROVISIONED_THROUGHPUT"
            }
          },
          {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": "primarily nitrogen and oxygen). These molecules scatter the sunlight in different directions.\n*   **Shorter wavelengths scatter more:** Shorter"
                    }
                  ],
                  "role": "model"
                },
                "groundingMetadata": {}
              }
            ],
            "createTime": "2025-08-28T03:55:44.786936Z",
            "modelVersion": "gemini-2.0-flash",
            "responseId": "QNOvaPiDMI_3ld8Py4ySuAk",
            "usageMetadata": {
              "trafficType": "PROVISIONED_THROUGHPUT"
            }
          },
          {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": " wavelengths of light, like blue and violet, are scattered more strongly than longer wavelengths like red and orange.\n*   **Why blue, not violet?** Although violet light is scattered slightly more than blue light"
                    }
                  ],
                  "role": "model"
                },
                "groundingMetadata": {}
              }
            ],
            "createTime": "2025-08-28T03:55:44.786936Z",
            "modelVersion": "gemini-2.0-flash",
            "responseId": "QNOvaPiDMI_3ld8Py4ySuAk",
            "usageMetadata": {
              "trafficType": "PROVISIONED_THROUGHPUT"
            }
          },
          {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": ", our eyes are more sensitive to blue. This is why we perceive the sky as blue.\n*   **Sunset colors:** When the sun is low on the horizon (during sunrise or sunset), sunlight"
                    }
                  ],
                  "role": "model"
                },
                "groundingMetadata": {}
              }
            ],
            "createTime": "2025-08-28T03:55:44.786936Z",
            "modelVersion": "gemini-2.0-flash",
            "responseId": "QNOvaPiDMI_3ld8Py4ySuAk",
            "usageMetadata": {
              "trafficType": "PROVISIONED_THROUGHPUT"
            }
          },
          {
            "candidates": [
              {
                "content": {
                  "parts": [
                    {
                      "text": " travels through a thicker layer of the atmosphere. This causes more of the blue light to be scattered away, leaving the longer wavelengths like orange and red to be more visible.\n"
                    }
                  ],
                  "role": "model"
                },
                "finishReason": "STOP",
                "groundingMetadata": {
                  "groundingChunks": [
                    {
                      "web": {
                        "domain": "youtube.com",
                        "title": "youtube.com",
                        "uri": "https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGhw1Uwq3BjyNrVOcV-0oWjgf7o52-Bkridaot9pKWBoYqxMS9xdkrI8AxEhBT2mSF8Mbi3anNL9UmfbgTkHR51ocGYk2If26arlJEbktXF3xVeEVywzrMjla0Yn8tdR8Hcvr01SQ=="
                      }
                    },
                    {
                      "web": {
                        "domain": "reddit.com",
                        "title": "reddit.com",
                        "uri": "https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQG289PW-q-17qZxHCMD5-knTOW9lerijJX4-EixZ1KL1mDs924Wm0lTK6nuL4Pn9J3AcT72mDYZCq43nBqcEiMrkQ14DAmmTIo317nheRyPc5t6HXZ9RWzAC5lP6Q8AXCGTdxNt8XSl1m70JFoLYf6XYmnL9b7geXZ23_hTvGN5Lw=="
                      }
                    },
                    {
                      "web": {
                        "domain": "desy.de",
                        "title": "desy.de",
                        "uri": "https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQEnxOWP-5U4pvvZpViEl2B-E_eeiqNytqXpWIVbES8p5IT3bCbve1P2Ln4Ce-GH6zXRF2IdPwy44Z5KkR53PPUzyZUYNdPSer9PSAjFwf4BhzvHnsvZDXsTuWC0Z_AkAlriGcoJK2vdRO7Kgu2qJfzHwVvhG_iUI5Eq1P2zDKRnRK4="
                      }
                    },
                    {
                      "web": {
                        "domain": "ucr.edu",
                        "title": "ucr.edu",
                        "uri": "https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGSfOUhlw5HTDWynuaJStRiXrmvd1z-EV6BMCofjs95i_dzRUASbBg0pJyspSx53-yoztFcyTW2BIjc4-ZsVRcsS-udkQfGy98oED2w19EnkjsA6wfPm6QaYwVARs_pCG5jFWeUl0k8CXURt2dxqQtS8EscovEZYncltAXHK_g="
                      }
                    },
                    {
                      "web": {
                        "domain": "lifeischemistry.com",
                        "title": "lifeischemistry.com",
                        "uri": "https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQHDk-g7wqzm_-tBhLUCnkCQeC7VpMVcKvxfS4c_Tq8aj7Acwtn_sPcOl3fm_8q8EPJuTQL9R1RN8neCQet9chP_nFswq677VweAw_5-g_tM197FugvB7QycItZZoLtQzevnoAKc9HVOAyDYczBzhMlLvLNY9QQ="
                      }
                    },
                    {
                      "web": {
                        "domain": "nasa.gov",
                        "title": "nasa.gov",
                        "uri": "https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQE8ZGB40FQay6ZubRS1Mt2GEhkpkey98AhU_Yc0M6N2P4VCQIeTqCG9icZPPfbm-vTgHkfD3bsXfu9ciz3VEuaWF9ncWR2DRB89GEbO1gF0zsDqYu6i-rf5sD719mXqww=="
                      }
                    },
                    {
                      "web": {
                        "domain": "rookieparenting.com",
                        "title": "rookieparenting.com",
                        "uri": "https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGE2f95-vmtTE5DU_ziJtOacIRD-3ejU7Uh3iab15tPpAtfHVTjf8gYttMnqq__h4Fp2TPf24cWehj8BzFkrLAoPZQXn4J1mZn0aBqspKhefkfjb4MEteEvqe6ycMbzQzEPllnb69YKb9zxljPIW28InyKIOYcYyz80Xa-AGFokECE="
                      }
                    }
                  ],
                  "groundingSupports": [
                    {
                      "confidenceScores": [
                        0.9716646,
                        0.9646024
                      ],
                      "groundingChunkIndices": [
                        0,
                        1
                      ],
                      "segment": {
                        "endIndex": 67,
                        "text": "The sky appears blue due to a phenomenon called Rayleigh scattering"
                      }
                    },
                    {
                      "confidenceScores": [
                        0.6212265,
                        0.5949765
                      ],
                      "groundingChunkIndices": [
                        2,
                        3
                      ],
                      "segment": {
                        "endIndex": 176,
                        "startIndex": 90,
                        "text": "*   **Sunlight and its colors:** Sunlight is composed of all the colors of the rainbow"
                      }
                    },
                    {
                      "confidenceScores": [
                        0.16731392,
                        0.7213338
                      ],
                      "groundingChunkIndices": [
                        1,
                        4
                      ],
                      "segment": {
                        "endIndex": 318,
                        "startIndex": 178,
                        "text": "*   **Atmospheric scattering:** When sunlight enters the Earth's atmosphere, it interacts with air molecules (primarily nitrogen and oxygen)"
                      }
                    },
                    {
                      "confidenceScores": [
                        0.3724535
                      ],
                      "groundingChunkIndices": [
                        5
                      ],
                      "segment": {
                        "endIndex": 380,
                        "startIndex": 320,
                        "text": "These molecules scatter the sunlight in different directions"
                      }
                    },
                    {
                      "confidenceScores": [
                        0.5031454,
                        0.6310358,
                        0.8470471
                      ],
                      "groundingChunkIndices": [
                        2,
                        0,
                        1
                      ],
                      "segment": {
                        "endIndex": 547,
                        "startIndex": 382,
                        "text": "*   **Shorter wavelengths scatter more:** Shorter wavelengths of light, like blue and violet, are scattered more strongly than longer wavelengths like red and orange"
                      }
                    },
                    {
                      "confidenceScores": [
                        0.017496027
                      ],
                      "groundingChunkIndices": [
                        6
                      ],
                      "segment": {
                        "endIndex": 680,
                        "startIndex": 576,
                        "text": "** Although violet light is scattered slightly more than blue light, our eyes are more sensitive to blue"
                      }
                    },
                    {
                      "confidenceScores": [
                        0.28572062,
                        0.36645037
                      ],
                      "groundingChunkIndices": [
                        6,
                        1
                      ],
                      "segment": {
                        "endIndex": 721,
                        "startIndex": 682,
                        "text": "This is why we perceive the sky as blue"
                      }
                    },
                    {
                      "confidenceScores": [
                        0.9261228,
                        0.57231665
                      ],
                      "groundingChunkIndices": [
                        1,
                        4
                      ],
                      "segment": {
                        "endIndex": 867,
                        "startIndex": 723,
                        "text": "*   **Sunset colors:** When the sun is low on the horizon (during sunrise or sunset), sunlight travels through a thicker layer of the atmosphere"
                      }
                    },
                    {
                      "confidenceScores": [
                        0.6381537,
                        0.6529436,
                        0.76996756
                      ],
                      "groundingChunkIndices": [
                        3,
                        2,
                        1
                      ],
                      "segment": {
                        "endIndex": 995,
                        "startIndex": 869,
                        "text": "This causes more of the blue light to be scattered away, leaving the longer wavelengths like orange and red to be more visible"
                      }
                    }
                  ],
                  "searchEntryPoint": {
                    "renderedContent": "\u003cstyle\u003e\n.container {\n  align-items: center;\n  border-radius: 8px;\n  display: flex;\n  font-family: Google Sans, Roboto, sans-serif;\n  font-size: 14px;\n  line-height: 20px;\n  padding: 8px 12px;\n}\n.chip {\n  display: inline-block;\n  border: solid 1px;\n  border-radius: 16px;\n  min-width: 14px;\n  padding: 5px 16px;\n  text-align: center;\n  user-select: none;\n  margin: 0 8px;\n  -webkit-tap-highlight-color: transparent;\n}\n.carousel {\n  overflow: auto;\n  scrollbar-width: none;\n  white-space: nowrap;\n  margin-right: -12px;\n}\n.headline {\n  display: flex;\n  margin-right: 4px;\n}\n.gradient-container {\n  position: relative;\n}\n.gradient {\n  position: absolute;\n  transform: translate(3px, -9px);\n  height: 36px;\n  width: 9px;\n}\n@media (prefers-color-scheme: light) {\n  .container {\n    background-color: #fafafa;\n    box-shadow: 0 0 0 1px #0000000f;\n  }\n  .headline-label {\n    color: #1f1f1f;\n  }\n  .chip {\n    background-color: #ffffff;\n    border-color: #d2d2d2;\n    color: #5e5e5e;\n    text-decoration: none;\n  }\n  .chip:hover {\n    background-color: #f2f2f2;\n  }\n  .chip:focus {\n    background-color: #f2f2f2;\n  }\n  .chip:active {\n    background-color: #d8d8d8;\n    border-color: #b6b6b6;\n  }\n  .logo-dark {\n    display: none;\n  }\n  .gradient {\n    background: linear-gradient(90deg, #fafafa 15%, #fafafa00 100%);\n  }\n}\n@media (prefers-color-scheme: dark) {\n  .container {\n    background-color: #1f1f1f;\n    box-shadow: 0 0 0 1px #ffffff26;\n  }\n  .headline-label {\n    color: #fff;\n  }\n  .chip {\n    background-color: #2c2c2c;\n    border-color: #3c4043;\n    color: #fff;\n    text-decoration: none;\n  }\n  .chip:hover {\n    background-color: #353536;\n  }\n  .chip:focus {\n    background-color: #353536;\n  }\n  .chip:active {\n    background-color: #464849;\n    border-color: #53575b;\n  }\n  .logo-light {\n    display: none;\n  }\n  .gradient {\n    background: linear-gradient(90deg, #1f1f1f 15%, #1f1f1f00 100%);\n  }\n}\n\u003c/style\u003e\n\u003cdiv class=\"container\"\u003e\n  \u003cdiv class=\"headline\"\u003e\n    \u003csvg class=\"logo-light\" width=\"18\" height=\"18\" viewBox=\"9 9 35 35\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"\u003e\n      \u003cpath fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M42.8622 27.0064C42.8622 25.7839 42.7525 24.6084 42.5487 23.4799H26.3109V30.1568H35.5897C35.1821 32.3041 33.9596 34.1222 32.1258 35.3448V39.6864H37.7213C40.9814 36.677 42.8622 32.2571 42.8622 27.0064V27.0064Z\" fill=\"#4285F4\"/\u003e\n      \u003cpath fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M26.3109 43.8555C30.9659 43.8555 34.8687 42.3195 37.7213 39.6863L32.1258 35.3447C30.5898 36.3792 28.6306 37.0061 26.3109 37.0061C21.8282 37.0061 18.0195 33.9811 16.6559 29.906H10.9194V34.3573C13.7563 39.9841 19.5712 43.8555 26.3109 43.8555V43.8555Z\" fill=\"#34A853\"/\u003e\n      \u003cpath fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M16.6559 29.8904C16.3111 28.8559 16.1074 27.7588 16.1074 26.6146C16.1074 25.4704 16.3111 24.3733 16.6559 23.3388V18.8875H10.9194C9.74388 21.2072 9.06992 23.8247 9.06992 26.6146C9.06992 29.4045 9.74388 32.022 10.9194 34.3417L15.3864 30.8621L16.6559 29.8904V29.8904Z\" fill=\"#FBBC05\"/\u003e\n      \u003cpath fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M26.3109 16.2386C28.85 16.2386 31.107 17.1164 32.9095 18.8091L37.8466 13.8719C34.853 11.082 30.9659 9.3736 26.3109 9.3736C19.5712 9.3736 13.7563 13.245 10.9194 18.8875L16.6559 23.3388C18.0195 19.2636 21.8282 16.2386 26.3109 16.2386V16.2386Z\" fill=\"#EA4335\"/\u003e\n    \u003c/svg\u003e\n    \u003csvg class=\"logo-dark\" width=\"18\" height=\"18\" viewBox=\"0 0 48 48\" xmlns=\"http://www.w3.org/2000/svg\"\u003e\n      \u003ccircle cx=\"24\" cy=\"23\" fill=\"#FFF\" r=\"22\"/\u003e\n      \u003cpath d=\"M33.76 34.26c2.75-2.56 4.49-6.37 4.49-11.26 0-.89-.08-1.84-.29-3H24.01v5.99h8.03c-.4 2.02-1.5 3.56-3.07 4.56v.75l3.91 2.97h.88z\" fill=\"#4285F4\"/\u003e\n      \u003cpath d=\"M15.58 25.77A8.845 8.845 0 0 0 24 31.86c1.92 0 3.62-.46 4.97-1.31l4.79 3.71C31.14 36.7 27.65 38 24 38c-5.93 0-11.01-3.4-13.45-8.36l.17-1.01 4.06-2.85h.8z\" fill=\"#34A853\"/\u003e\n      \u003cpath d=\"M15.59 20.21a8.864 8.864 0 0 0 0 5.58l-5.03 3.86c-.98-2-1.53-4.25-1.53-6.64 0-2.39.55-4.64 1.53-6.64l1-.22 3.81 2.98.22 1.08z\" fill=\"#FBBC05\"/\u003e\n      \u003cpath d=\"M24 14.14c2.11 0 4.02.75 5.52 1.98l4.36-4.36C31.22 9.43 27.81 8 24 8c-5.93 0-11.01 3.4-13.45 8.36l5.03 3.85A8.86 8.86 0 0 1 24 14.14z\" fill=\"#EA4335\"/\u003e\n    \u003c/svg\u003e\n    \u003cdiv class=\"gradient-container\"\u003e\u003cdiv class=\"gradient\"\u003e\u003c/div\u003e\u003c/div\u003e\n  \u003c/div\u003e\n  \u003cdiv class=\"carousel\"\u003e\n    \u003ca class=\"chip\" href=\"https://vertexaisearch.cloud.google.com/grounding-api-redirect/AUZIYQGpCXM1kS4AEmQijnPPkdLtnSmn6ypg3_I9XYJNh0G7xG1yqHaS4LSEL7ziqU4H5r_GbCAbrfFHJUi2On6OK-eFV0SP4cNfBvaVrZj5jFh7DAC5zvsIxTPenQXjBUnF2XHcUIhXyugCX9-jBYD1lWa9yp20gJkvDKUxbfpYXQVUjqp7sLIIUd7US5dBpqT9Ng8gVrksZZYLA2hQBGiBHQDxRQ==\"\u003eWhy is the sky blue explanation\u003c/a\u003e\n  \u003c/div\u003e\n\u003c/div\u003e\n"
                  },
                  "webSearchQueries": [
                    "Why is the sky blue explanation"
                  ]
                }
              }
            ],
            "createTime": "2025-08-28T03:55:44.786936Z",
            "modelVersion": "gemini-2.0-flash",
            "responseId": "QNOvaPiDMI_3ld8Py4ySuAk",
            "usageMetadata": {
              "candidatesTokenCount": 203,
              "candidatesTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 203
                }
              ],
              "promptTokenCount": 6,
              "promptTokensDetails": [
                {
                  "modality": "TEXT",
                  "tokenCount": 6
                }
              ],
              "totalTokenCount": 209,
              "trafficType": "PROVISIONED_THROUGHPUT"
            }
          }
        ]
      }
    }
  ]
}